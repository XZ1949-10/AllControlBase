<?xml version="1.0"?>
<!--
  单应性标定工具 Launch 文件
  
  功能: 标定相机图像与地面坐标的单应性变换关系
        标定完成后，可在 visualizer 中使用相机轨迹叠加功能
  
  使用方法:
    # 标定模式 (交互式标定)
    roslaunch controller_ros tools/trajectory_visualizer.launch calibration_mode:=true
    
    # 验证模式 (查看标定效果)
    roslaunch controller_ros tools/trajectory_visualizer.launch
    
    # 不显示窗口 (仅发布叠加图像)
    roslaunch controller_ros tools/trajectory_visualizer.launch show_window:=false
  
  标定步骤:
    1. 在机器人前方地面放置 4 个标记点
    2. 测量标记点相对于 base_footprint 的坐标 (x, y)
    3. 启动标定模式
    4. 按顺序点击图像中的 4 个标记点
    5. 在终端输入对应的地面坐标
    6. 按 's' 保存标定结果
    7. 标定文件保存在 config/homography_calib.yaml
  
  标定完成后:
    roslaunch controller_ros platforms/turtlebot1.launch visualizer:=true camera_image:=/usb_cam/image_raw
-->
<launch>
  <!-- ========== 参数 ========== -->
  <arg name="image_topic" default="/usb_cam/image_raw" doc="相机图像话题"/>
  <arg name="trajectory_topic" default="/nn/local_trajectory" doc="轨迹话题"/>
  <arg name="output_topic" default="/trajectory_overlay/image" doc="输出图像话题"/>
  <arg name="show_window" default="true" doc="是否显示 OpenCV 窗口"/>
  <arg name="calibration_mode" default="false" doc="是否进入标定模式"/>
  <arg name="calibration_file" default="$(find controller_ros)/config/homography_calib.yaml" doc="标定文件路径"/>
  
  <!-- ========== 轨迹可视化节点 ========== -->
  <node pkg="controller_ros" type="trajectory_visualizer.py" name="trajectory_visualizer" 
        output="screen">
    <param name="image_topic" value="$(arg image_topic)"/>
    <param name="trajectory_topic" value="$(arg trajectory_topic)"/>
    <param name="output_topic" value="$(arg output_topic)"/>
    <param name="show_window" value="$(arg show_window)"/>
    <param name="calibration_mode" value="$(arg calibration_mode)"/>
    <param name="calibration_file" value="$(arg calibration_file)"/>
  </node>
</launch>
