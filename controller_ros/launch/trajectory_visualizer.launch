<?xml version="1.0"?>
<!--
  轨迹可视化 Launch 文件
  
  功能: 在相机图像上实时显示网络输出的轨迹点
  
  使用方法:
    roslaunch controller_ros trajectory_visualizer.launch
    roslaunch controller_ros trajectory_visualizer.launch show_window:=false
-->
<launch>
  <!-- ========== 参数 ========== -->
  <arg name="image_topic" default="/usb_cam/image_raw" doc="相机图像话题"/>
  <arg name="trajectory_topic" default="/nn/local_trajectory" doc="轨迹话题"/>
  <arg name="output_topic" default="/trajectory_overlay/image" doc="输出图像话题"/>
  <arg name="show_window" default="true" doc="是否显示 OpenCV 窗口"/>
  
  <!-- 相机内参 (来自 Kinect 标定文件) -->
  <arg name="fx" default="525.0" doc="焦距 fx"/>
  <arg name="fy" default="525.0" doc="焦距 fy"/>
  <arg name="cx" default="319.5" doc="主点 cx"/>
  <arg name="cy" default="239.5" doc="主点 cy"/>
  
  <!-- 畸变系数 (plumb_bob 模型: k1, k2, p1, p2, k3) -->
  <arg name="k1" default="-0.10585" doc="径向畸变 k1"/>
  <arg name="k2" default="0.27096" doc="径向畸变 k2"/>
  <arg name="p1" default="0.0" doc="切向畸变 p1"/>
  <arg name="p2" default="0.00504" doc="切向畸变 p2"/>
  <arg name="k3" default="-0.00166" doc="径向畸变 k3"/>
  
  <!-- 相机安装位置 (相对于 base_footprint) -->
  <arg name="cam_x" default="0.08" doc="相机前方位置 (m)"/>
  <arg name="cam_y" default="0.0" doc="相机左右位置 (m)"/>
  <arg name="cam_z" default="0.50" doc="相机高度 (m)"/>
  <arg name="cam_pitch" default="0.0" doc="相机俯仰角 (rad, 正值向下看)"/>
  
  <!-- ========== 轨迹可视化节点 ========== -->
  <node pkg="controller_ros" type="trajectory_visualizer.py" name="trajectory_visualizer" 
        output="screen">
    <param name="image_topic" value="$(arg image_topic)"/>
    <param name="trajectory_topic" value="$(arg trajectory_topic)"/>
    <param name="output_topic" value="$(arg output_topic)"/>
    <param name="show_window" value="$(arg show_window)"/>
    <!-- 相机内参 -->
    <param name="fx" value="$(arg fx)"/>
    <param name="fy" value="$(arg fy)"/>
    <param name="cx" value="$(arg cx)"/>
    <param name="cy" value="$(arg cy)"/>
    <!-- 畸变系数 -->
    <param name="k1" value="$(arg k1)"/>
    <param name="k2" value="$(arg k2)"/>
    <param name="p1" value="$(arg p1)"/>
    <param name="p2" value="$(arg p2)"/>
    <param name="k3" value="$(arg k3)"/>
    <!-- 相机外参 -->
    <param name="cam_x" value="$(arg cam_x)"/>
    <param name="cam_y" value="$(arg cam_y)"/>
    <param name="cam_z" value="$(arg cam_z)"/>
    <param name="cam_pitch" value="$(arg cam_pitch)"/>
  </node>
</launch>
